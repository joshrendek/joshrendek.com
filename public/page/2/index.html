<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8" />
<meta name="author" content="" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.25.1" />

<meta property="og:title" content="Josh Rendek" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://joshrendek.com/" />



<meta property="og:updated_time" content="2014-09-14T12:02:21&#43;00:00"/>













<meta itemprop="name" content="Josh Rendek">
<meta itemprop="description" content="">



<link rel="stylesheet" type="text/css" href="/css/layout.css" />
<link rel="stylesheet" type="text/css" href="/css/pygments.css" />
<link rel="stylesheet" type="text/css" href="/css/color-dark.css" />


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-3754808-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


<title>


    Josh Rendek

</title>

<script src="/js/highlight.min.js"></script>
<link rel="stylesheet" href="/css/tomorrow-night.min.css" />
<script>hljs.initHighlightingOnLoad();</script>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://joshrendek.com">
        <span class='blue-brace'>{</span>
        Josh Rendek
        <span class='blue-brace'>}</span>
      </a>
      <div class="header-subtitle">
        <h2>
          <span class="heart">&lt;3</span> Ruby &amp; Go
        </h2>
      </div>
    </div> 
  </nav>
  <nav>
      
      
      <a class="nav-item active" href="/"><div class="nav-item-title">Home</div></a>
      
      <a class="nav-item" href="/projects/"><div class="nav-item-title">Projects</div></a>
      
      <a class="nav-item" href="/archives/"><div class="nav-item-title">Archives</div></a>
      
      <a class="nav-item" href="https://devopsbyvideo.com/"><div class="nav-item-title">Screen Casts</div></a>
      
      <a class="nav-item" href="/about/"><div class="nav-item-title">About</div></a>
      
      <a class="nav-item" href="/categories/"><div class="nav-item-title">Categories</div></a>
      
      <a class="nav-item" href="https://github.com/joshrendek/"><div class="nav-item-title">GitHub</div></a>
      
      <a class="nav-item" href="/resume.pdf"><div class="nav-item-title">Resume</div></a>
      
   </nav>
</div>

  
<div class="social-links-header">

  

  

  

  

  

</div>


</header>


<main>
  <div class="articles">
    
    
    <article class="post">
      <div class="date"> Sep 14, 2014 - 1 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/09/starting-out-with-hydroponics/'> Starting out with hydroponics</a> </h1>
      <div class="content"> <p><a href="http://hydronerd.com/2014/09/starting-hydroponics/">Moved to my new hydroponics website: <a href="http://hydronerd.com/">http://hydronerd.com/</a></a></p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Aug 22, 2014 - 1 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/08/rails-force-https-for-your-application/'> Rails force HTTPS for your application</a> </h1>
      <div class="content"> 

<h2 id="this-is-your-setup">This is your setup:</h2>

<ul>
<li>Nginx redirecting HTTP to HTTPS</li>
<li>Unicorn/puma/(etc) being reverse proxied to via nginx</li>
</ul>

<h2 id="what-you-may-not-realize">What you may not realize:</h2>

<p>When you&rsquo;re submitting a form and using the <code>redirect_to</code> or <code>respond_with @object, location: []</code> methods rails may not pick up that you want to use HTTPS as the protocol, adding this to your <code>application_controller.rb</code> ensures every URL generated by rails will go to a secure protocol:</p>

<p><code>ruby application_controller.rb
def default_url_options(options={})
    options.merge!(protocol: 'https') unless Rails.env.development? || Rails.env.test?
    options
end
</code></p>

<p>I ran into issues with rails redirecting to plain HTTP when doing some uploading utilizing iframes (and Chrome rightfully blocking the redirect back to http). Hope this helps someone else! No need to use any special gems.</p>

<p><strong><em>Note</em></strong>: This only applies if you want <strong>all</strong> actions to be HTTPS though.</p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Jul 8, 2014 - 2 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/07/go-lang-compare-star-ssh-dot-request-dot-type-against-a-string/'> Go-lang compare *ssh.Request.Type against a string</a> </h1>
      <div class="content"> <p>I was working on the agent for <a href="http://sshpot.com/">SSH Pot</a> and ran into something interesting last night. A lot of the brute force attempts attempt to run a command like this:</p>

<pre><code class="language-bash">ssh user@host 'uname'
</code></pre>

<p>This is different than:</p>

<pre><code class="language-bash">ssh user@host
$ uname
</code></pre>

<p>The first command is executing a command then exiting, the second is actually logging in and giving the user a shell. The first requests a exec subsystem and the second requests a shell subsystem - so there are two ways to handle it.</p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno"> 1 </span><span class="kd">func</span> <span class="nx">HandleShellRequest</span><span class="p">(</span><span class="nx">channel</span> <span class="nx">ssh</span><span class="p">.</span><span class="nx">Channel</span><span class="p">,</span> <span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="o">*</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2 </span>	<span class="k">for</span> <span class="nx">req</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">in</span> <span class="p">{</span>
<span class="lineno"> 3 </span>		<span class="nx">ok</span> <span class="o">:=</span> <span class="kc">true</span>
<span class="lineno"> 4 </span>		<span class="nx">logfile</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;[request &quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Type</span> <span class="o">+</span> <span class="s">&quot;]: &quot;</span> <span class="o">+</span> <span class="nb">string</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Payload</span><span class="p">))</span>
<span class="lineno"> 5 </span>		<span class="k">switch</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Type</span> <span class="p">{</span>
<span class="lineno"> 6 </span>		<span class="k">case</span> <span class="s">&quot;shell&quot;</span><span class="p">:</span>
<span class="lineno"> 7 </span>			<span class="nx">req</span><span class="p">.</span><span class="nx">Reply</span><span class="p">(</span><span class="nx">ok</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="lineno"> 8 </span>		<span class="k">case</span> <span class="s">&quot;exec&quot;</span><span class="p">:</span>
<span class="lineno"> 9 </span>			<span class="k">if</span> <span class="nb">string</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Payload</span><span class="p">)</span> <span class="o">==</span> <span class="nb">string</span><span class="p">(</span><span class="s">&quot;uname&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">10 </span>				<span class="nx">channel</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;\n\rLinux\n\r&quot;</span><span class="p">))</span>
<span class="lineno">11 </span>			<span class="p">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>			<span class="nx">channel</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="lineno">14 </span>		<span class="p">}</span>
<span class="lineno">15 </span>	<span class="p">}</span>
<span class="lineno">16 </span><span class="p">}</span>
</code></pre></div>


<p>When logging in my logfile it would show something like:</p>

<pre><code class="language-bash">[request exec]: uname
</code></pre>

<p>And even when comparing the two side by side with something like this:</p>

<p><div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno">1 </span><span class="nx">logfile</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;[&quot;</span><span class="o">+</span><span class="nb">string</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Payload</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;]:[&quot;</span><span class="o">+</span><span class="s">&quot;uname&quot;</span><span class="o">+</span><span class="s">&quot;]&quot;</span><span class="p">)</span>
</code></pre></div>
</p>

<p>I would get this output:</p>

<pre><code class="language-bash">[uname]:[uname]
</code></pre>

<p>Yet the comparison on line 9 would not get hit. After sitting and thinking about it for a while I decided to print the bytes out:</p>

<pre><code class="language-bash">INFO: 2014/07/07 23:15:18 sshd.go:157: [0 0 0 5 117 110 97 109 101]
INFO: 2014/07/07 23:15:18 sshd.go:158: [117 110 97 109 101]
</code></pre>

<p>Aha! So for some reason req.Payload is padded with 3 null bytes and a ENQ byte (hex 5).</p>

<p>Here is the corrected version removing the correct bytes - now the string comparison works:</p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno"> 1 </span><span class="kd">func</span> <span class="nx">HandleShellRequest</span><span class="p">(</span><span class="nx">channel</span> <span class="nx">ssh</span><span class="p">.</span><span class="nx">Channel</span><span class="p">,</span> <span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="o">*</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2 </span>	<span class="k">for</span> <span class="nx">req</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">in</span> <span class="p">{</span>
<span class="lineno"> 3 </span>		<span class="nx">ok</span> <span class="o">:=</span> <span class="kc">true</span>
<span class="lineno"> 4 </span>		<span class="nx">logfile</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;[request &quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Type</span> <span class="o">+</span> <span class="s">&quot;]: &quot;</span> <span class="o">+</span> <span class="nb">string</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Payload</span><span class="p">))</span>
<span class="lineno"> 5 </span>		<span class="k">switch</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Type</span> <span class="p">{</span>
<span class="lineno"> 6 </span>		<span class="k">case</span> <span class="s">&quot;shell&quot;</span><span class="p">:</span>
<span class="lineno"> 7 </span>			<span class="nx">req</span><span class="p">.</span><span class="nx">Reply</span><span class="p">(</span><span class="nx">ok</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="lineno"> 8 </span>		<span class="k">case</span> <span class="s">&quot;exec&quot;</span><span class="p">:</span>
<span class="lineno"> 9 </span>			<span class="k">if</span> <span class="nb">string</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Payload</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">==</span> <span class="nb">string</span><span class="p">(</span><span class="s">&quot;uname&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">10 </span>				<span class="nx">channel</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;\n\rLinux\n\r&quot;</span><span class="p">))</span>
<span class="lineno">11 </span>			<span class="p">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>			<span class="nx">channel</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="lineno">14 </span>		<span class="p">}</span>
<span class="lineno">15 </span>	<span class="p">}</span>
<span class="lineno">16 </span><span class="p">}</span>
</code></pre></div>

 </div>
    </article>
    
    <article class="post">
      <div class="date"> Jun 18, 2014 - 2 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/06/go-lang-mocking-exec-dot-command-using-interfaces/'> Go-lang: mocking exec.Command using interfaces</a> </h1>
      <div class="content"> <p>This is a short example showing how to use an interface to ease testing, and how to use an interface with running shell commands / other programs and providing mock output.</p>

<p><center>
<a href="https://github.com/joshrendek/go-exec-mock-example">Source on Github</a>
</center></p>

<p>Here is our main file that actually runs the commands and prints out &ldquo;hello&rdquo;.</p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno"> 1 </span><span class="kn">package</span> <span class="nx">main</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="kn">import</span> <span class="p">(</span>
<span class="lineno"> 4 </span>	<span class="s">&quot;fmt&quot;</span>
<span class="lineno"> 5 </span>	<span class="s">&quot;os/exec&quot;</span>
<span class="lineno"> 6 </span><span class="p">)</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="c1">// first argument is the command, like cat or echo,</span>
<span class="lineno"> 9 </span><span class="c1">// the second is the list of args to pass to it</span>
<span class="lineno">10 </span><span class="kd">type</span> <span class="nx">Runner</span> <span class="kd">interface</span> <span class="p">{</span>
<span class="lineno">11 </span>	<span class="nx">Run</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="lineno">12 </span><span class="p">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="kd">type</span> <span class="nx">RealRunner</span> <span class="kd">struct</span><span class="p">{}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="kd">var</span> <span class="nx">runner</span> <span class="nx">Runner</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="c1">// the real runner for the actual program, actually execs the command</span>
<span class="lineno">19 </span><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="nx">RealRunner</span><span class="p">)</span> <span class="nx">Run</span><span class="p">(</span><span class="nx">command</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">20 </span>	<span class="nx">out</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">).</span><span class="nx">CombinedOutput</span><span class="p">()</span>
<span class="lineno">21 </span>	<span class="k">return</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">err</span>
<span class="lineno">22 </span><span class="p">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="kd">func</span> <span class="nx">Hello</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
<span class="lineno">25 </span>	<span class="nx">out</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">runner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="lineno">26 </span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
<span class="lineno">27 </span>		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="lineno">28 </span>	<span class="p">}</span>
<span class="lineno">29 </span>	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span>
<span class="lineno">30 </span><span class="p">}</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
<span class="lineno">33 </span>	<span class="nx">runner</span> <span class="p">=</span> <span class="nx">RealRunner</span><span class="p">{}</span>
<span class="lineno">34 </span>	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Hello</span><span class="p">())</span>
<span class="lineno">35 </span><span class="p">}</span>
</code></pre></div>


<p>Here is our test file. We start by defining our <code>TestRunner</code> type and implementing the <code>Run(...)</code> interface for it.</p>

<p>This function builds up a command to run the current test file and run the <code>TestHelperProcess</code> function passing along all the args you originally sent. This lets you do things like return different output for different commands you want to run.</p>

<p>The <code>TestHelperProcess</code> function exits when run in the context of the test file, but runs when specified in the files arguments.</p>

<p><div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno"> 1 </span><span class="kn">package</span> <span class="nx">main</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="kn">import</span> <span class="p">(</span>
<span class="lineno"> 4 </span>	<span class="s">&quot;fmt&quot;</span>
<span class="lineno"> 5 </span>	<span class="s">&quot;os&quot;</span>
<span class="lineno"> 6 </span>	<span class="s">&quot;os/exec&quot;</span>
<span class="lineno"> 7 </span>	<span class="s">&quot;testing&quot;</span>
<span class="lineno"> 8 </span><span class="p">)</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="kd">type</span> <span class="nx">TestRunner</span> <span class="kd">struct</span><span class="p">{}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="nx">TestRunner</span><span class="p">)</span> <span class="nx">Run</span><span class="p">(</span><span class="nx">command</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">13 </span>	<span class="nx">cs</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;-test.run=TestHelperProcess&quot;</span><span class="p">,</span> <span class="s">&quot;--&quot;</span><span class="p">}</span>
<span class="lineno">14 </span>	<span class="nx">cs</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">cs</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="lineno">15 </span>	<span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">cs</span><span class="o">...</span><span class="p">)</span>
<span class="lineno">16 </span>	<span class="nx">cmd</span><span class="p">.</span><span class="nx">Env</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;GO_WANT_HELPER_PROCESS=1&quot;</span><span class="p">}</span>
<span class="lineno">17 </span>	<span class="nx">out</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">CombinedOutput</span><span class="p">()</span>
<span class="lineno">18 </span>	<span class="k">return</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">err</span>
<span class="lineno">19 </span><span class="p">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">22 </span>	<span class="nx">runner</span> <span class="p">=</span> <span class="nx">TestRunner</span><span class="p">{}</span>
<span class="lineno">23 </span>	<span class="nx">out</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">()</span>
<span class="lineno">24 </span>	<span class="k">if</span> <span class="nx">out</span> <span class="o">==</span> <span class="s">&quot;testing helper process&quot;</span> <span class="p">{</span>
<span class="lineno">25 </span>		<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;out was eq to %s&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">out</span><span class="p">))</span>
<span class="lineno">26 </span>	<span class="p">}</span>
<span class="lineno">27 </span><span class="p">}</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span><span class="kd">func</span> <span class="nx">TestHelperProcess</span><span class="p">(</span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">30 </span>	<span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GO_WANT_HELPER_PROCESS&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span> <span class="p">{</span>
<span class="lineno">31 </span>		<span class="k">return</span>
<span class="lineno">32 </span>	<span class="p">}</span>
<span class="lineno">33 </span>	<span class="k">defer</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="lineno">34 </span>	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;testing helper process&quot;</span><span class="p">)</span>
<span class="lineno">35 </span><span class="p">}</span>
</code></pre></div>
</p>

<p>Hopefully this helps someone else! I had a hard time finding some good, short examples on the internet that combined both interfaces and mocking like this.</p>

<p><center>
<a href="http://golang.org/src/pkg/os/exec/exec_test.go">More examples from os/exec/exec_test.go</a>
</center></p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Jun 9, 2014 - 1 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/06/a-useful-logger-in-go/'> A useful logger in Go</a> </h1>
      <div class="content"> <p>Small function that will print out useful information when invoked:</p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="lineno"> 1 </span><span class="kd">func</span> <span class="nx">logMsg</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2 </span>	<span class="nx">pc</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 3 </span>	<span class="nx">caller</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">FuncForPC</span><span class="p">(</span><span class="nx">pc</span><span class="p">).</span><span class="nx">Name</span><span class="p">()</span>
<span class="lineno"> 4 </span>	<span class="nx">_</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 5 </span>	<span class="nx">sp</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="lineno"> 6 </span>	<span class="nx">short_path</span> <span class="o">:=</span> <span class="nx">sp</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">sp</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nx">sp</span><span class="p">)]</span>
<span class="lineno"> 7 </span>	<span class="nx">path_line</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;[%s/%s:%d]&quot;</span><span class="p">,</span> <span class="nx">short_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">short_path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">line</span><span class="p">)</span>
<span class="lineno"> 8 </span>	<span class="nx">log_string</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;[%s]%s %s:: %s&quot;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span> <span class="nx">path_line</span><span class="p">,</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
<span class="lineno"> 9 </span>	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">log_string</span><span class="p">)</span>
<span class="lineno">10 </span><span class="p">}</span>
</code></pre></div>


<p>Sample output:</p>

<pre><code class="language-bash">[2014-06-10 01:38:45.812215998 +0000 UTC][src/trex-client.go:15]{main.main}:: checking jobs - finish
[2014-06-10 01:38:47.329650331 +0000 UTC][src/trex-client.go:15]{main.main}:: building package list - start
</code></pre>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Apr 26, 2014 - 6 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2014/04/motivation-to-work-on-new-projects/'> Motivation to work on new projects</a> </h1>
      <div class="content"> 

<p>Whenever I have spare time ( often around Christmas or when I&rsquo;m on vacation/traveling ), I tend to fill it with working on projects I&rsquo;ve built up in my backlog. I&rsquo;m also really trying to keep a continuous streak of OSS commits going on Github (something about filling that chart up makes me want to work harder). Here&rsquo;s my process and how I go about working on personal projects and try to stay motivated - if you have any ideas I&rsquo;d love to hear them in the comments!</p>

<h2 id="have-a-backlog">Have a backlog</h2>

<p>I use Evernote for all my ideas and project notes:</p>

<p><img src="/images/motivation/evernote.png" alt="Evernote" /></p>

<p>I have two columns - one for things in progress or to do and one for projects that are done ( with a link to any github repos I published ). When I have some downtime but don&rsquo;t feel like actually writing any code - I&rsquo;ll write out plans for what the project needs (use cases, backend needs, software I plan on using, etc) and do research and store all that as a sub-note in Evernote (you can see that with the light green link to the HAProxy Frontend ) under the main page. Plus I can easily share these with friends for feedback by just copying the share URL.</p>

<h2 id="use-small-milestones-to-build-up-bigger-ones">Use small milestones to build up bigger ones</h2>

<p>For instance, when I was working on the code for <a href="https://github.com/joshrendek/scala-ifcfg-api">http://ifcfg.net/</a> I decided there were two major components I would need to create: the web api to access the data, and then a backing library to do some web scraping to gather BGP data.
I started out writing a small scraper in Scala for scraping BGP and looking glass info (which involved learning some more SBT, and selenium apis for Scala) and then moved onto learning a small amount of the Play! framework and exposing my library via that api. This let me focus on one small component at a time and finish it ( I have a habit of leaving personal projects unfinished or taking a long time to finish them if I let the scope creep beyond what I deemed as minimum requirements ).</p>

<h2 id="pick-an-interesting-project">Pick an interesting project</h2>

<p>There are some areas I just don&rsquo;t have an interest in - like writing an application to track golf scores.</p>

<p>So pick something you like - I love doing backend systems and APIs - pick something your passionate about already or a topic you want to learn more about.</p>

<h2 id="learn">Learn</h2>

<p>If I&rsquo;m working on a personal project and not learning anything new (even if its just a new way to test, for instance) - I get bored, <em>really</em> quickly. I&rsquo;ve been stemming this by trying to pick up new languages as I work on projects and working on projects with broader goals.</p>

<p>For instance, my latest project I&rsquo;m working on is <a href="https://github.com/joshrendek/patchasaurus">Patchasaurus</a> ( yes there isn&rsquo;t a readme yet ). I know theres a gap in the systems world for (open source) patch management, especially focused on Ubuntu and Debian - so I decided to write a small initial version of one.
I had been playing around with Go at work (and boy is it nice to get a HTTP API running in a few MB of RAM) and decided to write the <em>agent</em> for patchasaurus in that ( nicknamed <em>trex</em> ).
I&rsquo;ve been learning how to cross compile programs in Go, what libraries don&rsquo;t work with cross-compilation (looking at you <code>os/user</code>) and a nice work flow for testing these while developing them ( sshfs is great for this with VirtualBox or Vagrant ).
I also chose to use Rails 4.1 as the management interface since I wanted to stay up to date with the new Rails features - turns out <code>spring</code> is very nice and a great improvement over the guard work flow I&rsquo;ve used before.</p>

<h2 id="don-t-focus-on-processes-versus-getting-things-done">Don&rsquo;t focus on processes versus getting things done</h2>

<p>I&rsquo;m a big fan of testing, and TDD, however I&rsquo;m not always in the mood to do it. Sometimes I just want to see results and I&rsquo;ll go back and refactor and test later. Picking what works for you on a specific project/component, and getting it done I think is much more important than rigidly following a specific set of guidelines on every project you do ( aka: test first, setup CI before any code, etc ).</p>

<h2 id="don-t-get-in-a-rut">Don&rsquo;t get in a rut</h2>

<p>Staring at HackerNews or Reddit all day can be daunting - try and not focus on what everyone else is doing and instead focus on what you&rsquo;re getting done and how you&rsquo;re improving yourself.</p>

<p>Also don&rsquo;t let this influence your technology choices. Sometimes there are articles trending for <code>AngularJS</code> or <code>Ruby on Rails</code> - stick with what you picked ( unless you really want to learn that new tech ) - or figure out ways to incorporate that into smaller components of your project. Don&rsquo;t throw away all that progress just because you saw a few posts reach the page!</p>

<h2 id="take-breaks">Take breaks</h2>

<p>Don&rsquo;t spend all day coding - take breaks, go for a walk, a run, play with your dog, play a video game - something that can give you a moment to breathe and think about something else or give you time to re-focus on the grand vision you&rsquo;ve been laboring over. Figure out what works for you to relax and do it to break up that screen glow tan you&rsquo;re getting.</p>

<h2 id="talk-about-what-you-re-working-on">Talk about what you&rsquo;re working on</h2>

<p>Talk with friends to brainstorm ideas, pair up on some problems, see if theres a more idiomatic way to do a function in the language your using ( for example, I spent some time trying to see if there were any <code>map()</code> equivalents on #go-nuts), and blog about what you&rsquo;re doing if that&rsquo;s your style.</p>

<p>Knowing people are using code and software I&rsquo;ve written is a huge motivating factor to working on future projects ( star/watch counts on Github, downloads on RubyGems, traffic to my blog, etc).</p>

<h2 id="finish">Finish!!</h2>

<p>Yes it can be hard, but figure out what <em>finished</em> means to you, and do it. Publish it on Github, submit it to HackerNews, post it to reddit, get it hooked into TravisCI - make sure you come to the finish line of each component or project you&rsquo;re working on. Building up these small accomplishments can help set a streak for the future so you have the motivation to power through and get items done.</p>

<p>Sometimes you&rsquo;re more interested in getting an application finished than on the deployment process - throw it on Heroku, a shared hosting provider, etc.  There&rsquo;s nothing wrong with some shared hosting for a small project. Don&rsquo;t let things like deployment stop you from finishing!</p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Nov 15, 2013 - 3 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2013/11/2-patterns-for-refactoring-with-your-ruby-application/'> 2 patterns for refactoring with your ruby application</a> </h1>
      <div class="content"> <p>When working on a rails application you can sometimes find duplicated or very similar code between two different controllers (for instance a UI element and an API endpoint).
Realizing that you have this duplication there are several things you can do. I&rsquo;m going to go over how to extract this code out into the
query object pattern <sup><a href="http://www.martinfowler.com/eaaCatalog/queryObject.html">1</a></sup>
and clean up our constructor using the builder pattern <sup><a href="http://en.wikipedia.org/wiki/Builder_pattern">2</a></sup> adapted to ruby.</p>

<p>I&rsquo;m going to make a few assumptions here, but this should be applicable to any
data access layer of your application. I&rsquo;m also assuming you&rsquo;re using something like Kaminari for pagination and have a model
for <code>People</code>.</p>

<pre><code class="language-ruby">
def index
  page = params[:page] || 1
  per_page = params[:per_page] || 50
  name = params[:name]
  sort = params[:sort_by] || 'last_name'
  direction = params[:sort_direction] || 'asc'

  query = People
  query = query.where(name: name) if name.present?
  @results = query.order(&quot;#{sort} #{direction}&quot;).page(page).per_page(per_page)
end

</code></pre>

<p>So we see this duplicated elsehwere in the code base and we want to clean it up. Lets first start by extracting this out into a new class called <code>PeopleQuery</code>.</p>

<p>I usually put these under <code>app/queries</code> in my rails application.</p>

<pre><code class="language-ruby">
class PeopleQuery
  attr_accessor :page, :per_page, :name, :sort, :direction, :query
  def initialize(page, per_page, name, sort, direction)
    self.page = page || 1
    self.per_page = per_page || 50
    self.name = name
    self.sort = sort || 'last_name'
    self.direction = direction || 'asc'
    self.query = People
  end

  def build
    self.query = self.query.where(name: self.name) if self.name.present?
    self.query.order(&quot;#{self.sort} #{self.direction}&quot;).page(self.page).per_page(self.per_page)
  end
end

</code></pre>

<p>Now our controller looks like this:</p>

<pre><code class="language-ruby">
def index
  query = PeopleQuery.new(params[:page], params[:per_page], params[:name], params[:sort], params[:direction])
  @results = query.build
end

</code></pre>

<p>Much better! We&rsquo;ve decoupled our control from our data access object (<code>People</code>/ActiveRecord), moved some of the query logic outside of the controller and into
a specific class meant to deal with building it. But that constructor doesn&rsquo;t look very nice. We can do better since we&rsquo;re using ruby.</p>

<p>Our new <code>PeopleQuery</code> class will look like this and will use a block to initialize itself instead of a long list of constructor arguments.</p>

<pre><code>class PeopleQuery
  attr_accessor :page, :per_page, :name, :sort, :direction, :query
  def initialize(&amp;block)
    yield self
    self.page ||= 1
    self.per_page =|| 50
    self.sort ||= 'last_name'
    self.direction ||= 'asc'
    self.query = People
  end

  def build
    self.query = self.query.where(name: self.name) if self.name.present?
    self.query.order(&quot;#{self.sort} #{self.direction}&quot;).page(self.page).per_page(self.per_page)
  end
end
</code></pre>

<p>We yield first to let the caller set the values and then after yielding we set our default values if they weren&rsquo;t passed in. There is another method of doing this
with <code>instance_eval</code> but you end up losing variable scope and the constructor looks worse since you have to start passing around the params variable to get access to it, so we&rsquo;re
going to stick with yield.</p>

<pre><code class="language-ruby">
def index
  query = PeopleQuery.new do |query|
    query.page = params[:page]
    query.per_page = params[:per_page]
    query.name = params[:name]
    query.sort = params[:sort]
    query.direction = params[:direction]
  end
  @results = query.build
end

</code></pre>

<p>And that&rsquo;s it! We&rsquo;ve de-duplicated some code (remember we assumed dummy controller&rsquo;s index method was duplicated elsewhere in an API call in a seperate namespaced controller),
extracted out a common query object, decoupled our controller from ActiveRecord, and built up a nice way to construct the query object using the builder pattern.</p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Oct 31, 2013 - 2 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2013/10/parsing-html-in-scala/'> Parsing HTML in Scala</a> </h1>
      <div class="content"> <p>Is there ever a confusing amount of information out there on parsing HTML in Scala. Here is the list of possible ways I ran across:</p>

<ul>
<li>Hope the document is valid XHTML and use <code>scala.xml.XML</code> to parse it</li>
<li>If the document isn&rsquo;t valid XHTML use something like TagSoup and hope it parses again</li>
<li>Still think its valid XHTML? Try using <code>scalaz</code>&rsquo;s XML parser</li>
</ul>

<p>All of the answers I found on Google pointed to some type of XML parsing, which won&rsquo;t always work. Coming from Ruby I know there are tools out there like Selenium that can simulate a web browser for you and give you a rich interface to interact with the returned HTML.</p>

<p>So I went on Maven and found the two Selenium web drivers I wanted for my project and added them to my <code>libraryDependencies</code>:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="lineno">1 </span>    <span class="s">&quot;org.seleniumhq.webdriver&quot;</span> <span class="o">%</span> <span class="s">&quot;webdriver-selenium&quot;</span> <span class="o">%</span> <span class="s">&quot;0.9.7376&quot;</span><span class="o">,</span>
<span class="lineno">2 </span>    <span class="s">&quot;org.seleniumhq.webdriver&quot;</span> <span class="o">%</span> <span class="s">&quot;webdriver-htmlunit&quot;</span> <span class="o">%</span> <span class="s">&quot;0.9.7376&quot;</span>
</code></pre></div>


<p>The project I&rsquo;m working on is to parse Looking Glass websites for BGP information and AS peering, so I wanted to scrape the data. I also didn&rsquo;t want to have to use a full blown web browser (ala Selenium + Firefox for instance) - so I stuck with the <code>HtmlUnit</code> driver for the implementation.</p>

<p>Here is a quick code snippet that lets me grab AS #&rsquo;s and Peer names from an AS:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="lineno"> 1 </span><span class="k">val</span> <span class="n">url</span> <span class="k">=</span> <span class="s">&quot;http://example.com/AS&quot;</span> <span class="o">+</span> <span class="n">as</span><span class="o">.</span><span class="n">toString</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="k">val</span> <span class="n">driver</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HtmlUnitDriver</span>
<span class="lineno"> 4 </span><span class="c1">// Proxy for BetaMax when writing tests</span>
<span class="lineno"> 5 </span><span class="k">if</span> <span class="o">(</span><span class="nc">_port</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno"> 6 </span>  <span class="n">driver</span><span class="o">.</span><span class="n">setProxy</span><span class="o">(</span><span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="nc">_port</span><span class="o">)</span>
<span class="lineno"> 7 </span><span class="o">}</span>
<span class="lineno"> 8 </span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="k">val</span> <span class="n">peers</span> <span class="k">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">findElementsByXPath</span><span class="o">(</span><span class="s">&quot;//*[@id=\&quot;table_peers4\&quot;]/tbody/tr/td[position() = 1 or position() = 2]&quot;</span><span class="o">)</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="c1">// zip up the list in pairs so List(a,b,c,d) becomes List((a,b), (c,d))</span>
<span class="lineno">13 </span><span class="k">for</span><span class="o">(</span><span class="n">peer</span> <span class="k">&lt;-</span> <span class="n">peers</span> <span class="n">zip</span> <span class="n">peers</span><span class="o">.</span><span class="n">tail</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">14 </span>  <span class="n">println</span><span class="o">(</span><span class="n">peer</span><span class="o">)</span>
<span class="lineno">15 </span><span class="o">}</span>
</code></pre></div>


<p>No XML to muck with and I get some nice selectors to query the document for. Remember if the source you want data from doesn&rsquo;t have an API, HTML is an API! Just be respectful of how you query and interact with them (ie: Don&rsquo;t do 100 requests/second, cache/record responses while writing tests, etc).</p>
 </div>
    </article>
    
    <article class="post">
      <div class="date"> Oct 28, 2013 - 3 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2013/10/getting-started-with-scala/'> Getting started with Scala</a> </h1>
      <div class="content"> 

<p>Recently I&rsquo;ve been getting into more Java and (attempting to) Scala development. I always got annoyed with the Scala ecosystem for development and would get fed up and just go back to writing straight Java (*cough*sbt<em>cough</em>). Today I decided to write down everything I did and get a sane process going for Scala development with SBT.</p>

<p>I decided to write a small Scala client for <a href="http://openweathermap.org">OpenWeatherMap</a> - here is what I went through.</p>

<p>A brief guide on naming conventions is <a href="http://docs.scala-lang.org/style/naming-conventions.html">here</a>. I found this useful just to reference conventions since not everything is the same as Ruby (camelCase vs snake_case for instance).</p>

<h2 id="setting-up-and-starting-a-project">Setting up and starting a project</h2>

<p>First make sure you hava a JVM installed, Scala, and SBT. I&rsquo;ll be using Scala 2.10.2 and SBT 0.12.1 since that is what I have installed.</p>

<p>One of the nice things I like about Ruby on Rails is the project generation ( aka: <code>rails new project [opts]</code> ) so I was looking for something similar with Scala.</p>

<p>Enter giter8: <a href="https://github.com/n8han/giter8">https://github.com/n8han/giter8</a></p>

<p>giter8 runs through SBT and has <a href="http://github.com/n8han/giter8/wiki/giter8-templates">templates</a> available for quickstart.</p>

<p>Follow the install instructions and install giter8 into SBT globally and load SBT to make sure it downloads and installs.</p>

<p>Once you do that you can pick a template from the list, or go with the one I chose: <code>fayimora/basic-scala-project</code> which sets up the directories properly and also sets up <a href="www.scalatest.org">ScalaTest</a>, a testing framework with a DSL similar to RSpec.</p>

<p>To setup your project you need to run:</p>

<pre><code>g8 fayimora/basic-scala-project
</code></pre>

<p>You&rsquo;ll be prompted with several questions and then your project will be made. Switch into that directory and run <code>sbt test</code> to make sure the simple HelloWorld passes and everything with SBT is working.</p>

<h2 id="setting-up-intellij">Setting up IntelliJ</h2>

<p>For Java and Scala projects I stick with IntelliJ over my usual vim. When using Java IntelliJ is good about picking up library and class path&rsquo;s and resolving dependencies (especially if you are using Maven). However there isn&rsquo;t a good SBT plugin (as of writing this) that manages to do all this inside IntelliJ.</p>

<p>The best plugin for SBT I&rsquo;ve found that does this is <a href="https://github.com/mpeltonen/sbt-idea">sbt-idea</a>. You&rsquo;re going to need to make a <code>project/plugins.sbt</code> file:</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="lineno">1 </span><span class="n">addSbtPlugin</span><span class="o">(</span><span class="s">&quot;com.github.mpeltonen&quot;</span> <span class="o">%</span> <span class="s">&quot;sbt-idea&quot;</span> <span class="o">%</span> <span class="s">&quot;1.5.2&quot;</span><span class="o">)</span>
</code></pre></div>


<p>and now you can generate your <code>.idea</code> files by running: <code>sbt gen-idea</code></p>

<p>IntelliJ should now resolve your project dependencies and you can start coding your project.</p>

<h2 id="final-result">Final Result</h2>

<p><a href="https://github.com/joshrendek/scala-weather">scala-weather</a> - A simple to use OpenWeatherMap client in Scala set up with Travis-CI and CodeClimate. This is just the first of several projects I plan on working on / open sourcing to get my feet wet with Scala more.</p>

<h2 id="useful-libraries">Useful libraries</h2>

<ul>
<li>HTTP: <a href="www.bigbeeconsultants.co.uk/bee-client">Bee Client</a></li>
<li>HTTP Mocking: <a href="http://freeside.co/betamax/">BetaMax</a></li>
<li>JSON Parsing: <a href="http://json4s.org/">Json4s</a></li>
<li>Testing: <a href="http://scalatest.org">ScalaTest</a></li>
<li>Logging: <a href="http://logback.qos.ch/">logback</a></li>
</ul>

<h2 id="notes">Notes</h2>

<p>By default Bee Client will log everything to STDOUT - you&rsquo;ll need to configure <a href="http://logback.qos.ch">logback</a> with an XML file located in <code>src/main/resources/logback.xml</code>:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="nt">&lt;configuration&gt;</span>
<span class="lineno"> 2 </span>    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 3 </span>        <span class="nt">&lt;encoder&gt;</span>
<span class="lineno"> 4 </span>            <span class="nt">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="nt">&lt;/pattern&gt;</span>
<span class="lineno"> 5 </span>        <span class="nt">&lt;/encoder&gt;</span>
<span class="lineno"> 6 </span>    <span class="nt">&lt;/appender&gt;</span>
<span class="lineno"> 7 </span>    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;ERROR&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 8 </span>        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
<span class="lineno"> 9 </span>    <span class="nt">&lt;/root&gt;</span>
<span class="lineno">10 </span><span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>

 </div>
    </article>
    
    <article class="post">
      <div class="date"> Jul 17, 2013 - 5 minutes</div>
      <h1 class="title"> <a href='https://joshrendek.com/2013/07/from-0-to-testing-on-windows-with-jruby/'> From 0 to Testing on Windows with JRuby</a> </h1>
      <div class="content"> 

<p>Testing is one of the most important parts of software development and helps to ensure
bugs don&rsquo;t get into production and that code can be refactored safely.
If you&rsquo;re working on a team with multiple people with different skill sets,
you might have people doing testing who only know windows and development is only
using OSX or Linux. We want everyone to be able to test - someone in QA who is familiar
with Windows shouldn&rsquo;t have to throw away all that knowledge, install Linux, and start from scratch.
Enter JRuby and John.</p>

<p>John is our tester and he is running windows. He wants to help make sure that when a user
goes to <code>http://google.com/</code> that a button appears with the text &ldquo;Google Search&rdquo;.
The quick way to do this is to open his browser, navigate to <code>http://google.com/</code>
glance through the page for the button and confirm that its there.
John has a problem though, he has 30 other test cases to run and the developers are pushing code to the frontpage
several times a day; John now has to continously do this manually everytime code is touched and
his test load is piling up.</p>

<p>So let&rsquo;s help John out and install <a href="http://sublimetext.com/2">Sublime Text 2</a> and <a href="http://jruby.org/">JRuby</a>.</p>

<p><img src="/images/jrubytesting/download-sublime.png" alt="" /></p>

<p>Start by downloading the 64-bit version of Sublime Text.
Make sure to add the context menu when going through the install process.</p>

<p><img src="/images/jrubytesting/slt-setup.png" alt="" /></p>

<p>Now we&rsquo;ll visit the JRuby homepage and download the 64 bit installer.</p>

<p><img src="/images/jrubytesting/dl-jruby.png" alt="" /></p>

<p>Go through the installer and let JRuby set your path so you can access ruby from <code>cmd.exe</code></p>

<p><img src="/images/jrubytesting/jruby-path.png" alt="" /></p>

<p>Now when we open <code>cmd.exe</code> and type <code>jruby -v</code> we&rsquo;ll be able to see that it was installed.</p>

<p><img src="/images/jrubytesting/jruby-cmd.png" alt="" /></p>

<p>Now that we have our tools installed lets setup our test directory on the Desktop.
Inside our <code>testing</code> folder we&rsquo;ll create a folder called <code>TestDemo</code> for our tests for the Demo project.</p>

<p><img src="/images/jrubytesting/testdemo-folder.png" alt="" /></p>

<p>Next we&rsquo;ll open Sublime Text and go to <code>File &gt; Open Folder</code> and navigate to our <code>TestDemo</code> folder and hit open.</p>

<p><img src="/images/jrubytesting/slt-openfolder.png" alt="" /></p>

<p>Now we can continue making our directory structure inside Sublime Text. Since we&rsquo;re going to use <code>rspec</code>
we need to create a folder called <code>spec</code> to contain all of our tests. Right click on the <code>TestDemo</code> in the
tree navigation and click <code>New Folder</code>.</p>

<p><img src="/images/jrubytesting/slt-newfolder.png" alt="" /></p>

<p>Call the folder <code>spec</code> in the bottom title bar when it prompts you for the folder name.</p>

<p>Next we&rsquo;ll create our Gemfile which will declare all of our dependencies - so make a file in the project root called
<code>Gemfile</code> and put the our dependencies in it:</p>

<pre><code class="language-ruby">source &quot;https://rubygems.org&quot;

gem &quot;rspec&quot;
gem &quot;selenium&quot;
gem &quot;selenium-webdriver&quot;
gem &quot;capybara&quot;

</code></pre>

<p>Once we have that file created, open <code>cmd.exe</code> and switch to your project&rsquo;s root directory.</p>

<p>Type <code>jgem install bundler</code> to install <code>bundler</code> which manages ruby dependencies.</p>

<p><img src="/images/jrubytesting/bundler.png" alt="" /></p>

<p>While still at the command prompt we&rsquo;re going to <code>bundle</code> to install our dependencies:</p>

<p><img src="/images/jrubytesting/bundle.png" alt="" /></p>

<p>After that finishes we need to run one last command for <code>selenium</code> to work properly: <code>selenium install</code></p>

<p><img src="/images/jrubytesting/selenium-install.png" alt="" /></p>

<p>We also need a <code>spec_helper.rb</code> file inside our <code>spec</code> directory.</p>

<pre><code class="language-ruby">require &quot;rspec&quot;
require &quot;selenium&quot;
require &quot;capybara/rspec&quot;

Capybara.default_driver =  :selenium
</code></pre>

<p>We&rsquo;ve now setup our rspec folders, our Gemfile with dependencies, and installed them. Now we can write
the test that will save John a ton of time.</p>

<p>Chrome comes with a simple tool to get XPath paths so we&rsquo;re going to use that to get the XPath
for the search button. Right click on the &ldquo;Google Search&rdquo; button and click <code>Inspect element</code></p>

<p><img src="/images/jrubytesting/google-inspect.png" alt="" /></p>

<p>Right click on the highlighted element and hit <code>Copy XPath</code>.</p>

<p><img src="/images/jrubytesting/google-xpath.png" alt="" /></p>

<p>Now we&rsquo;re going to make our spec file and call it <code>homepage_spec.rb</code> and locate it under <code>spec\integration</code>.</p>

<p>Here is a picture showing the directory structure and files:
<img src="/images/jrubytesting/homepage-spec.png" alt="" /></p>

<p>Here is the spec file with comments explaining each part:</p>

<pre><code class="language-ruby"># This loads the spec helper file that we required everything in
require &quot;spec_helper&quot;

# This is the outer level description of the test
# For this example it describes going to the homepage of Google.com
# Setting the feature type is necessary if you have
# Capybara specs outside of the spec\features folder
describe &quot;Going to google.com&quot;, :type =&gt; :feature do

  # Context is like testing a specific component of the homepage, in this case
  # its the search button
  context &quot;The search button&quot; do
    # This is our actual test where we give it a meaningful test description
    it &quot;should contain the text 'Google Search'&quot; do
      visit &quot;http://google.com/&quot; # Opens Firefox and visits google
      button = find(:xpath, '//*[@id=gbqfba&quot;') # find an object on the page by its XPath path
      # This uses an rspec assertion saying that the string returned
      # by button.text is equal to &quot;Google Search&quot;
      button.text.should eq(&quot;Google Seearch&quot;)

    end
  end

end

</code></pre>

<p>Now we can tab back to our <code>cmd.exe</code> prompt and run our tests!
<code>rspec spec</code> will run all your tests under the <code>spec</code> folder.
<img src="/images/jrubytesting/rspec-spec.png" alt="" /></p>

<h3 id="things-to-take-note-of">Things to take note of</h3>

<p>This example scenario is showing how to automate browser testing to do end-to-end tests on a product using rspec.
This is by no means everything you can do with rspec and ruby - you can SSH, hit APIs and parse JSON, and do anything
you want with the ability to make assertions.</p>

<p>A lot is going on in these examples - there are plenty of resources out there on google and other websites
that provide more rspec examples and ruby examples.</p>

<p>We also showed how to add dependencies and install them using <code>bundler</code>.
Two of the best resources for finding libraries and other gems is
<a href="http://rubygems.org/">RubyGems</a> and <a href="http://ruby-toolbox.com/">Ruby-Toolbox</a> - the only thing to take note of
is anything saying to be a native C extension (they won&rsquo;t work with JRuby out of the box).</p>

<p>My last note is that you also need to have firefox installed as well - Selenium will work with Chrome but I&rsquo;ve found it to be a
hassle to setup (and unless you really need Chrome), the default of Firefox will work great.</p>
 </div>
    </article>
    
  </div>

  <div class="sidebar">
  <section>
    <h1>Projects & Software</h1>
    <ul>
      <li><a href="https://github.com/joshrendek/docker-conductor">Docker Conductor</a> is a docker orchestration tool.</li>
      <li><a href="http://sshpot.com/">sshpot.com</a> is a SSH honeypot service written in Go (both web service and client are open source).</li>
      <li><a href="http://ifcfg.net/">ifcfg.net</a> is a simple 'what is my IP' service with a few extra RESTful endpoints.</li>

      <li><a href="/projects/">View More</a>

      <li><a href="https://github.com/joshrendek?tab=repositories"><img src="/images/github.png" style='border: none;'> More on GitHub</a></li>
      <li><a href="https://rubygems.org/profiles/joshrendek">Gems @ RubyGems</a></li>
    </ul>
  </section>

  <section>
    <h1>Other Blogs</h1>
    <ul>
      <li><a href="http://tendermeatlove.com">Tender Meat Love</a> is my blog about cooking.</li>
      <li><a href="http://hydronerd.com">Hydro Nerd</a> is my blog about hydroponics and gardening.</li>
    </ul>
  </section>

  <section>
    <h1>Recent Posts</h1>
    <ul>
      
      <li><a href="https://joshrendek.com/2016/06/building-honeypots-and-analyzing-linux-malware/">Building honeypots and analyzing linux malware</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/understanding-elasticsearch-performance/">Understanding ElasticSearch Performance</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/building-a-distributed-waitgroup-with-go-and-redis/">Building a distributed WaitGroup with Go and Redis</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/docker-and-ping-sendmsg-operation-not-permitted/">Docker and ping: sendmsg: Operation not permitted</a></li>
      
      <li><a href="https://joshrendek.com/2015/10/influx-alert/">Influx Alert</a></li>
      
    </ul>
  </section>

</div>

</main>

<div class="page-nav">
  <div class="page-prev">
    
        <a href="/" title="Previous page" > &lt;&lt; </a>
    
  </div>

  <div class="page-num">
    2/12
  </div>

  <div class="page-next">
    
    <a href="/page/3/" title="Next page"> >> </a>
    
  </div>
</div> 


  <footer>

  <div class="social-links-footer">

  

  

  

  

  

  <div class="social-link">
  <a href="https://joshrendek.com/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright"> © Copyright 2008-2017 Josh Rendek </div>

  </footer>

</body>
</html>

