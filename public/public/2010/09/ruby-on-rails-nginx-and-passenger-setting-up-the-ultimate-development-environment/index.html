
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby on Rails, NGINX, and Passenger: Setting Up the Ultimate Development Environment - Josh Rendek</title>
  <meta name="author" content="Josh Rendek">

  
  <meta name="description" content="My office (underneath the desks) is a mess of cables. I have a dual monitor setup for my mac pro, usually having documentation (or a video) on the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://joshrendek.com/2010/09/ruby-on-rails-nginx-and-passenger-setting-up-the-ultimate-development-environment">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Josh Rendek" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3754808-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">
      <span class="blue-brace">{</span>Josh Rendek<span class="blue-brace">}</span>
  </a></h1>
  
  <div class="subtitle">
  <h2>
    <span class="heart"><3</span> Ruby &amp; Go
  </h2>
  </div>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:joshrendek.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="https://devopsbyvideo.com/">Screen Casts</a></li>
  <li><a href="/categories">Categories</a></li>
  <li><a href="/resume/">Resum√©</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="https://github.com/joshrendek">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby on Rails, NGINX, and Passenger: Setting Up the Ultimate Development Environment</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-15T12:14:01-04:00" pubdate data-updated="true">Sep 15<sup>th</sup>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>My office (underneath the desks) is a mess of cables. I have a dual monitor setup for my mac pro, usually having documentation (or a video) on the second screen, and coding going on in my main 28&#8221; HANNS-G. I love developing rails applications on my mac because of the tools I have available to me and how easy it is to access them. However I wanted to keep running applications on linux (since thats where they end up going) and doing some other specific linux things.</p>

<p>I have all my programs / apps in a directory called /apps/ and I wanted to use Nginx and the passenger gem to handle everything.</p>

<p>I want to do all my development on my Mac and running the applications on linux. I have a spare Dell Vostro 200 that used to be my gaming desktop that now has CentOS installed on it.</p>

<p>Goals: Lets say I have an application called foobar . When (on my mac) I go to foobar.dev, it should go to my linux box and load the foobar app from nginx+passenger .</p>

<p>To keep everything in sync, I&rsquo;m going to use NFS and export the directory from my mac to my linux box. Thankfully on mac it is ridiculously easy to setup NFS.</p>

<p>Replace things in caps like XXX and YOURUSERNAME with your information. Obviously if your network is different or mask, change it. I would not do this on a public server. I did this on my private, firewalled home network.</p>

<p>Just add this to /etc/exports:</p>

<pre>/Users/YOURUSERNAME/apps/  -rw -mapall=root -network 192.168.0.0 -mask 255.255.0.0</pre>


<p>You may need to restart NFSD on your mac:</p>

<pre> sudo nfsd restart</pre>


<p>Once your NFS is working you should be able to issue a command:</p>

<pre> showmount -e</pre>


<p>and you&rsquo;ll see your export list.</p>

<p>You can then mount this on your linux box:</p>

<pre>cd /home
mkdir apps
mount -t nfs 192.168.1.XXX:/Users/YOURUSERNAME/apps apps</pre>


<p>Next step you should install WEBMIN. You can this in a few different ways, but for CentOS:</p>

<pre>cd ~
wget http://prdownloads.sourceforge.net/webadmin/webmin-1.520-1.noarch.rpm
rpm -Uvh webmin-1.520-1.noarch.rpm</pre>


<p>Login at <a href="https://YOURLINUXIP:10000/.">https://YOURLINUXIP:10000/.</a> We&rsquo;re going to setup BIND and the DNS server. You could do this without webmin, but webmin lets you do it in a few clicks, and setting up DNS isn&rsquo;t one of my strong points.</p>

<p>Navigate to Servers -> Bind DNS Server.</p>

<p>Click on &ldquo;Create master zone&rdquo;. Enter &ldquo;dev&rdquo; into the domain, so it should look like this:</p>

<p style="text-align: center;"><a href="http://bluescripts.net/wp-content/uploads/2010/09/Webmin-1.520-on-localhost.localdomain-CentOS-Linux-5.5.png"><img class="size-medium wp-image-410   aligncenter" title="Webmin 1.520 on localhost.localdomain (CentOS Linux 5.5)" src="http://bluescripts.net/wp-content/uploads/2010/09/Webmin-1.520-on-localhost.localdomain-CentOS-Linux-5.5-300x65.png" alt="" width="300" height="65" /></a></p>


<p style="text-align: left;">After that hit &#8220;Create&#8221;.</p>


<p style="text-align: left;">Back on the &#8220;Module Index&#8221;, click on the &#8220;dev&#8221; world icon, and click on Address records. Enter *.dev into the name field and the IP of your linux server, once created it should look like this:</p>


<p style="text-align: center;"><a href="http://bluescripts.net/wp-content/uploads/2010/09/Webmin-1.520-on-localhost.localdomain-CentOS-Linux-5.5-1.png"><img class="size-medium wp-image-413  aligncenter" title="Webmin 1.520 on localhost.localdomain (CentOS Linux 5.5)-1" src="http://bluescripts.net/wp-content/uploads/2010/09/Webmin-1.520-on-localhost.localdomain-CentOS-Linux-5.5-1-300x91.png" alt="" width="300" height="91" /></a></p>


<p style="text-align: left;">Hit &#8220;Apply configuration&#8221; in the very top right corner and your done with the linux DNS setup.</p>


<p style="text-align: left;">On your Mac, to use the new DNS go to System Preferences -> Network (choose your adapter) -> Advanced -> DNS.</p>


<p style="text-align: left;">I&#8217;m using Google DNS but you need to add your new DNS server in there as well. It should look like this when you&#8217;re done (or similar, depending on your IPs and previous DNS configuration):</p>


<p style="text-align: center;"><a href="http://bluescripts.net/wp-content/uploads/2010/09/System-Preferences.png"><img class="size-medium wp-image-414  aligncenter" title="System Preferences" src="http://bluescripts.net/wp-content/uploads/2010/09/System-Preferences-300x259.png" alt="" width="300" height="259" /></a></p>


<p style="text-align: left;">DNS configuration is done, just to verify you should be able to ping ANYTHING.dev or foobar.dev or blah.dev and it should resolve to your linux server&#8217;s IP:</p>


<p style="text-align: left;"></p>


<p style="text-align: center;"><a href="http://bluescripts.net/wp-content/uploads/2010/09/ping.png"><img class="size-medium wp-image-415  aligncenter" title="ping" src="http://bluescripts.net/wp-content/uploads/2010/09/ping-300x214.png" alt="" width="300" height="214" /></a></p>


<p style="text-align: left;">On your linux box, go ahead and install ruby, rails, and rubygems. Once you have that running and working, install passenger:</p>


<p style="text-align: left;"></p>




<pre>gem install passenger</pre>


<p style="text-align: left;">Then run the nginx setup:</p>




<pre>passenger-install-nginx-module</pre>


<p>This will install Nginx for you and configure /opt/nginx/conf/nginx.conf for you as well.</p>

<p>I&rsquo;ve shrunk my nginx.conf down to this, and modified it to load *.dev as server and host names.</p>

<pre>#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    passenger_root /opt/ruby-enterprise-1.8.7-2010.01/lib/ruby/gems/1.8/gems/passenger-2.2.15;
    passenger_ruby /opt/ruby-enterprise-1.8.7-2010.01/bin/ruby;

    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
    server_name   ~^(www\.)?([-\w\.]+)\.\w+$;
        #charset koi8-r;

        #access_log  logs/host.access.log  main;
            root   /home/apps/$2/public;
        passenger_enabled on;
        rails_env development;
    }

}</pre>


<p>The important line is <strong>server_name √Ç¬† ~^(www.)?([-\w.]+).\w+$; </strong>This allows you to catch those domains.</p>

<p>My Mac is my database server (it has an SSD and 8 gigs of memory and is backed up, so I keep everything on it). Now I need to let my linux box connect to my mac pro&rsquo;s mysql instance.</p>

<p>I use SequelPro to do my database management, and you need to run the following queries:</p>

<pre>CREATE USER 'root'@'%' IDENTIFIED BY 'YOURPASSWORD';
GRANT ALL PRIVILEGES ON *.* to 'root'@'%' WITH GRANT OPTION;</pre>


<p>Run the query and you should be all set. You can start Nginx and your applications should start running when you go to foobar.dev or yourappname.dev !</p>

<p>I found this took a bit of time to do (although this tutorial should let you do it in a few minutes) but it saves me from having to worry about start/shutting down thin/mongrel&rsquo;s and other stuff on my mac.</p>

<p>Let me know if you have any comments or questions!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Josh Rendek</span></span>

      








  


<time datetime="2010-09-15T12:14:01-04:00" pubdate data-updated="true">Sep 15<sup>th</sup>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://joshrendek.com/2010/09/ruby-on-rails-nginx-and-passenger-setting-up-the-ultimate-development-environment/" data-via="" data-counturl="http://joshrendek.com/2010/09/ruby-on-rails-nginx-and-passenger-setting-up-the-ultimate-development-environment/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/09/mac-im-an-ide-whore/" title="Previous Post: Mac: I'm an IDE whore">&laquo; Mac: I'm an IDE whore</a>
      
      
        <a class="basic-alignment right" href="/2010/10/ruby-and-ebay-get-list-prices/" title="Next Post: Ruby and Ebay: Get list prices">Ruby and Ebay: Get list prices &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Projects & Software</h1>
  <ul>
    <li><a href="https://github.com/joshrendek/docker-conductor">Docker Conductor</a> is a docker orchestration tool.</li>
    <li><a href="http://sshpot.com/">sshpot.com</a> is a SSH honeypot service written in Go (both web service and client are open source).</li>
    <li><a href="http://ifcfg.net/">ifcfg.net</a> is a simple 'what is my IP' service with a few extra RESTful endpoints.</li>

    <li><a href="/projects/">View More</a>

    <li><a href="https://github.com/joshrendek?tab=repositories"><img src="/images/github.png" style='border: none;'> More on GitHub</a></li>
    <li><a href="https://rubygems.org/profiles/joshrendek">Gems @ RubyGems</a></li>
  </ul>
</section>

<section>
  <h1>Other Blogs</h1>
  <ul>
    <li><a href="http://tendermeatlove.com">Tender Meat Love</a> is my blog about cooking.</li>
    <li><a href="http://hydronerd.com">Hydro Nerd</a> is my blog about hydroponics and gardening.</li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/06/building-honeypots-and-analyzing-linux-malware/">Building Honeypots and Analyzing Linux Malware</a>
      </li>
    
      <li class="post">
        <a href="/2015/11/understanding-elasticsearch-performance/">Understanding ElasticSearch Performance</a>
      </li>
    
      <li class="post">
        <a href="/2015/11/building-a-distributed-waitgroup-with-go-and-redis/">Building a Distributed WaitGroup With Go and Redis</a>
      </li>
    
      <li class="post">
        <a href="/2015/11/docker-and-ping-sendmsg-operation-not-permitted/">Docker and Ping: Sendmsg: Operation Not Permitted</a>
      </li>
    
      <li class="post">
        <a href="/2015/10/influx-alert/">Influx Alert</a>
      </li>
    
      <li class="post">
        <a href="/2015/09/getting-upstart-to-log-to-syslog-with-tags/">Getting Upstart to Log to Syslog With Tags</a>
      </li>
    
      <li class="post">
        <a href="/2015/09/golang-performance-tips/">Golang Performance Tips</a>
      </li>
    
  </ul>
</section>







  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Josh Rendek -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bluescripts';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
