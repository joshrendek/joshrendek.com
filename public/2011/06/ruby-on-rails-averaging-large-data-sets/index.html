<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8" />
<meta name="author" content="" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.25.1" />

<meta property="og:title" content="Ruby on Rails: Averaging Large Data Sets" />
<meta property="og:description" content="Graphing objects client side is a great way to avoid generating them server side (since client side scales infinitely). You do however run into issue when you get into thousands, or hundreds of thousands of points (for example displaying 5 minute intervals in a month: 8928). When graphing this many points javascript can hang or cause the browser to seem like its not responding.
This is a simple solution that I&rsquo;ve been using for a while to average data points from a Active Record model: 1 def generic_graph(column, hours, multiplier = 1) 2  beginning = Time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joshrendek.com/2011/06/ruby-on-rails-averaging-large-data-sets/" />



<meta property="article:published_time" content="2011-06-15T00:27:20&#43;00:00"/>
<meta property="article:modified_time" content="2011-06-15T00:27:20&#43;00:00"/>













  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="Ruby on Rails: Averaging Large Data Sets"/>
<meta name="twitter:title" content="Ruby on Rails: Averaging Large Data Sets"/>
<meta name="twitter:description" content="Graphing objects client side is a great way to avoid generating them server side (since client side scales infinitely). You do however run into issue when you get into thousands, or hundreds of thousands of points (for example displaying 5 minute intervals in a month: 8928). When graphing this many points javascript can hang or cause the browser to seem like its not responding.
This is a simple solution that I&rsquo;ve been using for a while to average data points from a Active Record model: 1 def generic_graph(column, hours, multiplier = 1) 2  beginning = Time."/>




<meta itemprop="name" content="Ruby on Rails: Averaging Large Data Sets">
<meta itemprop="description" content="Graphing objects client side is a great way to avoid generating them server side (since client side scales infinitely). You do however run into issue when you get into thousands, or hundreds of thousands of points (for example displaying 5 minute intervals in a month: 8928). When graphing this many points javascript can hang or cause the browser to seem like its not responding.
This is a simple solution that I&rsquo;ve been using for a while to average data points from a Active Record model: 1 def generic_graph(column, hours, multiplier = 1) 2  beginning = Time.">


<meta itemprop="dateModified" content="2011-06-15T00:27:20&#43;00:00" />
<meta itemprop="wordCount" content="194">



<meta itemprop="keywords" content="" />


<link rel="stylesheet" type="text/css" href="/css/layout.css" />
<link rel="stylesheet" type="text/css" href="/css/pygments.css" />
<link rel="stylesheet" type="text/css" href="/css/color-dark.css" />


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-3754808-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


<title>


     Ruby on Rails: Averaging Large Data Sets 

</title>

<script src="/js/highlight.min.js"></script>
<link rel="stylesheet" href="/css/tomorrow-night.min.css" />
<script>hljs.initHighlightingOnLoad();</script>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://joshrendek.com">
        <span class='blue-brace'>{</span>
        Josh Rendek
        <span class='blue-brace'>}</span>
      </a>
      <div class="header-subtitle">
        <h2>
          <span class="heart">&lt;3</span> Ruby &amp; Go
        </h2>
      </div>
    </div> 
  </nav>
  <nav>
      
      
      <a class="nav-item" href="/"><div class="nav-item-title">Home</div></a>
      
      <a class="nav-item" href="/projects/"><div class="nav-item-title">Projects</div></a>
      
      <a class="nav-item" href="/archives/"><div class="nav-item-title">Archives</div></a>
      
      <a class="nav-item" href="https://devopsbyvideo.com/"><div class="nav-item-title">Screen Casts</div></a>
      
      <a class="nav-item" href="/about/"><div class="nav-item-title">About</div></a>
      
      <a class="nav-item" href="/categories/"><div class="nav-item-title">Categories</div></a>
      
      <a class="nav-item" href="https://github.com/joshrendek/"><div class="nav-item-title">GitHub</div></a>
      
      <a class="nav-item" href="/resume.pdf"><div class="nav-item-title">Resume</div></a>
      
   </nav>
</div>

  
<div class="social-links-header">

  

  

  

  

  

</div>


</header>


<main>
  <div class="articles">
    <article class="post">
      <div class="date"> Jun 15, 2011 - 1 minutes</div>
      <h1 class="title"> Ruby on Rails: Averaging Large Data Sets </h1>
      <div class="content"> <p>Graphing objects client side is a great way to avoid generating them server side (since client side scales infinitely). You do however run into issue when you get into thousands, or hundreds of thousands of points (for example displaying 5 minute intervals in a month: 8928). When graphing this many points javascript can hang or cause the browser to seem like its not responding.</p>

<p>This is a simple solution that I&rsquo;ve been using for a while to average data points from a Active Record model:
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1 </span><span class="k">def</span> <span class="nf">generic_graph</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 2 </span>    <span class="n">beginning</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="ss">:hours</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="n">hours</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="n">x</span> <span class="o">=</span> <span class="no">YourModel</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;created_at &gt; ?&quot;</span><span class="p">,</span> <span class="n">beginning</span>
<span class="lineno"> 4 </span>    <span class="n">arr</span> <span class="o">=</span> <span class="o">[]</span>
<span class="lineno"> 5 </span>    <span class="n">timeoffset</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">utc_offset</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">dst?</span> <span class="p">?</span> <span class="n">timeoffset</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>    <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="c1">#or whatever number works for you</span>
<span class="lineno"> 9 </span>      <span class="n">x</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="p">,</span><span class="n">y</span><span class="o">|</span>
<span class="lineno">10 </span>        <span class="n">tmp_averaged</span> <span class="o">=</span> <span class="n">x</span><span class="o">[</span><span class="n">y</span><span class="o">..</span><span class="n">y</span><span class="o">+</span><span class="mi">24</span><span class="o">].</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">ss</span><span class="o">|</span> <span class="n">ss</span><span class="o">[</span><span class="n">column</span><span class="o">]</span> <span class="p">}</span> <span class="c1"># collect 24 (or however many you want) records, then average them</span>
<span class="lineno">11 </span>        <span class="n">arr</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">s</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="ss">:hours</span><span class="o">=&gt;</span><span class="n">timeoffset</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tmp_averaged</span><span class="o">.</span><span class="n">average</span><span class="o">]</span> <span class="c1"># this is for going into the flot.js graphing library</span>
<span class="lineno">12 </span>      <span class="k">end</span>
<span class="lineno">13 </span>    <span class="k">else</span>
<span class="lineno">14 </span>      <span class="n">x</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">arr</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">s</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="ss">:hours</span><span class="o">=&gt;</span><span class="n">timeoffset</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">s</span><span class="o">[</span><span class="n">column</span><span class="o">]</span> <span class="o">]</span> <span class="p">}</span>
<span class="lineno">15 </span>    <span class="k">end</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>    <span class="n">arr</span><span class="o">.</span><span class="n">to_s</span> <span class="c1">#output for flot</span>
<span class="lineno">18 </span>  <span class="k">end</span>
</code></pre></div>
</p>
 </div>
      <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
</div>

  </div>

</footer>


  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'bluescripts';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>
  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




    </article>
  </div>
  <div class="sidebar">
  <section>
    <h1>Projects & Software</h1>
    <ul>
      <li><a href="https://github.com/joshrendek/docker-conductor">Docker Conductor</a> is a docker orchestration tool.</li>
      <li><a href="http://sshpot.com/">sshpot.com</a> is a SSH honeypot service written in Go (both web service and client are open source).</li>
      <li><a href="http://ifcfg.net/">ifcfg.net</a> is a simple 'what is my IP' service with a few extra RESTful endpoints.</li>

      <li><a href="/projects/">View More</a>

      <li><a href="https://github.com/joshrendek?tab=repositories"><img src="/images/github.png" style='border: none;'> More on GitHub</a></li>
      <li><a href="https://rubygems.org/profiles/joshrendek">Gems @ RubyGems</a></li>
    </ul>
  </section>

  <section>
    <h1>Other Blogs</h1>
    <ul>
      <li><a href="http://tendermeatlove.com">Tender Meat Love</a> is my blog about cooking.</li>
      <li><a href="http://hydronerd.com">Hydro Nerd</a> is my blog about hydroponics and gardening.</li>
    </ul>
  </section>

  <section>
    <h1>Recent Posts</h1>
    <ul>
      
      <li><a href="https://joshrendek.com/2016/06/building-honeypots-and-analyzing-linux-malware/">Building honeypots and analyzing linux malware</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/understanding-elasticsearch-performance/">Understanding ElasticSearch Performance</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/building-a-distributed-waitgroup-with-go-and-redis/">Building a distributed WaitGroup with Go and Redis</a></li>
      
      <li><a href="https://joshrendek.com/2015/11/docker-and-ping-sendmsg-operation-not-permitted/">Docker and ping: sendmsg: Operation not permitted</a></li>
      
      <li><a href="https://joshrendek.com/2015/10/influx-alert/">Influx Alert</a></li>
      
    </ul>
  </section>

</div>

</main>
  <footer>

  <div class="social-links-footer">

  

  

  

  

  

  <div class="social-link">
  <a href="https://joshrendek.com/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright"> © Copyright 2008-2017 Josh Rendek </div>

  </footer>

</body>
</html>

